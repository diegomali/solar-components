import{b as t}from"./p-fe5b2c7a.js";import{B as i}from"./p-05671e06.js";import{C as e}from"./p-bfa157e3.js";const s=t=>t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()));function n(t){return t?t instanceof Array?t:[t]:[]}function r(t,i,e){const s=i.split(/\[/).map((t=>t.replace(/\]/,"")));let n;let r=t;let h=null;for(n=0;n<s.length;n++){if(/^(\s*|\d+)$/.test(s[n])){if(!(h[s[n-1]]instanceof Array)){h[s[n-1]]=[]}const t=r;r=h[s[n-1]];h=t;continue}if(Array.isArray(r)){r.push(r[s[n]]||{})}else{r[s[n]]=r[s[n]]||{}}h=r;r=r[s[n]]}if(r instanceof Array){r.push(e)}else{h[s[n-1]]=e}return t}function h(t,i={}){const e={};Array.prototype.slice.call(t.querySelectorAll("[name]"+(i.ignoreDisabled?":not([disabled])":""))).forEach((t=>{if(t.name&&["file","reset","button"].indexOf(t.type)===-1&&t.tagName.indexOf("-")===-1){switch(t.type){case"select-multiple":const i=[];Array.prototype.slice.call(t.options).forEach((t=>{if(t.selected){i.push(t.value)}}));r(e,t.name,i);break;case"checkbox":if(t.checked){r(e,t.name,true)}case"radio":if(t.checked){r(e,t.name,t.value)}break;default:if(t.value){r(e,t.name,t.value)}break}}}));return e}var a=undefined&&undefined.__decorate||function(t,i,e,s){var n=arguments.length,r=n<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,e):s,h;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(t,i,e,s);else for(var a=t.length-1;a>=0;a--)if(h=t[a])r=(n<3?h(r):n>3?h(i,e,r):h(i,e))||r;return n>3&&r&&Object.defineProperty(i,e,r),r};const f=t("solar:FormBehavior");class o extends e{constructor(){super(...arguments);this.fields=new Map;this.preventUnsavedIsAttached=false}static forNative(t){return new o({host:t,preventUnsaved:t.dataset.hasOwnProperty("preventUnsaved"),disconnectedCallback:null,native:true})}handleSubmit(t){f("Submitting",this);t.preventDefault();const i=!!this.isValid;if(!i||this.isUnchecked){this.checkValidity().then((t=>{if(Object.keys(t).length===0){this.component.host.dispatchEvent(new CustomEvent("formSubmit"))}}))}}attach(){f("Initializing",this);this.component.host.addEventListener("submit",this.handleSubmit)}detach(){this.component.host.removeEventListener("submit",this.handleSubmit)}setValid(){f("Set valid",this);this.isValid=true;this.component.host.classList.remove("form--invalid");this.component.host.classList.add("form--valid")}setInvalid(){f("Set invalid",this);this.isValid=false;this.component.host.classList.remove("form--valid");this.component.host.classList.add("form--invalid")}setUnchecked(){f("Set unchecked",this);this.isUnchecked=true;this.isValid=false;this.component.host.classList.remove("form--valid","form--invalid");this.component.host.classList.add("form--unchecked");if(!this.preventUnsavedIsAttached&&(this.component.preventUnsaved||this.component.preventUnsaved==="")){f("Preventing Unsaved");window.addEventListener("beforeunload",(t=>{if(this.isUnchecked){const i=this.component.preventUnsaved;(t||window.event).returnValue=i;return i}}));this.preventUnsavedIsAttached=true}}setChecked(){f("Set checked",this);this.isUnchecked=false;this.component.host.classList.remove("form--unchecked")}cleanup(){f("Cleaning",this);this.pristine();const t=Array.from(this.fields.values());t.forEach((t=>t.cleanup()))}pristine(){f("Set pristine",this);this.isValid=false;this.isUnchecked=false;this.component.host.classList.remove("form--unchecked","form--valid","form--invalid")}addField(t){this.fields.set(t.name,t)}removeField(t){this.fields.delete(t.name)}async checkValidity(){f("Validating formBehavior",this);this.setChecked();const t=Array.from(this.fields.values());const i={};await Promise.all(t.map((t=>t.checkValidity().then((e=>{if(!e.valid){i[t.name]=e}})))));if(Object.keys(i).length===0){this.setValid()}else{this.setInvalid();this.component.host.dispatchEvent(new CustomEvent("formInvalid",{detail:i}))}return i}serialize(t){f("Serializing",this.component.host,h(this.component.host,t));return h(this.component.host,t)}}a([i],o.prototype,"handleSubmit",null);var l=undefined&&undefined.__decorate||function(t,i,e,s){var n=arguments.length,r=n<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,e):s,h;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(t,i,e,s);else for(var a=t.length-1;a>=0;a--)if(h=t[a])r=(n<3?h(r):n>3?h(i,e,r):h(i,e))||r;return n>3&&r&&Object.defineProperty(i,e,r),r};var d=undefined&&undefined.__rest||function(t,i){var e={};for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0)e[s]=t[s];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,s=Object.getOwnPropertySymbols(t);n<s.length;n++){if(i.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n]))e[s[n]]=t[s[n]]}return e};const c=t("solar:FormFieldBehavior");class u extends e{attach(){this.name=this.component.name;this.formAttached=this.component.host.closest("form");if(this.formAttached){c("Attaching",this.name,this.formAttached);if(!this.formAttached.formBehavior){this.formAttached.formBehavior=o.forNative(this.formAttached)}this.formAttached.formBehavior.addField(this)}this.component.host.addEventListener("invalid",this.checkValidity)}detach(){if(this.formAttached){c("Detaching",this.name,this.formAttached);this.formAttached.formBehavior.removeField(this)}this.component.host.removeEventListener("invalid",this.checkValidity)}setDirty(){c("Set dirty",this.name,this.formAttached);this.component.host.classList.add("form-field--dirty");this.isDirty=true;if(this.formAttached){this.formAttached.formBehavior.setUnchecked()}}setTouched(){c("Set touched",this.name);this.component.host.classList.add("form-field--touched");this.isTouched=true}setValid(){c("Set valid",this.name);this.component.host.classList.add("form-field--valid");this.component.host.classList.remove("form-field--invalid");this.isValid=true}setInvalid(){c("Set invalid",this.name);this.component.host.classList.add("form-field--invalid");this.component.host.classList.remove("form-field--valid");this.isValid=false}cleanup(){c("Cleaning up",this.name);this.component.host.classList.remove("form-field--invalid","form-field--valid","form-field--touched","form-field--dirty");this.component.value=undefined;this.component.error=undefined;this.isValid=undefined;this.isTouched=undefined;this.isDirty=undefined}async checkValidity(t){const i=t||this.component.value||"";c("Validating",this.name,"=",i);let e={valid:true};const s=n(this.component.validator);const r=this.component.getNativeFormField?await this.component.getNativeFormField():null;if(r){const t=r.validity;e.badInput=t.badInput;e.customError=t.customError;e.patternMismatch=t.patternMismatch;e.rangeOverflow=t.rangeOverflow;e.rangeUnderflow=t.rangeUnderflow;e.stepMismatch=t.stepMismatch;e.tooLong=t.tooLong;e.tooShort=t.tooShort;e.typeMismatch=t.typeMismatch;e.valid=t.valid;e.valueMissing=t.valueMissing}const h=this.formAttached?this.formAttached.formBehavior:null;for(const t of s){let s;try{const e=t(i,this,h);s=e instanceof Promise?await e:e}catch(i){c("Error in validator function",t.name,i)}if(s){e=Object.assign(Object.assign({},e),s);const{valid:t}=e,i=d(e,["valid"]);if(t){e.valid=!Object.values(i).find((t=>!!t))}}}if(e.valid){this.component.error=null;this.setValid()}else{this.component.error=this.buildErrorMessageByValidityState(e)||true;this.setInvalid();this.component.host.dispatchEvent(new CustomEvent("formFieldInvalid",{detail:e}))}this.component.validity=e;return e}addValidator(t){if(!this.component.validator){this.component.validator=[]}else if(!(this.component.validator instanceof Array)){this.component.validator=[this.component.validator]}this.component.validator.push(t);return this}getCustomErrorMessagesFromInlineAttrs(){const t=this.component.host.attributes;return Object.keys(t).map((i=>t[i].name)).filter((t=>t.indexOf("-message")>-1)).reduce(((i,e)=>{i[s(e)]=t[e].value;return i}),{})}getErrorMessages(){return this.getCustomErrorMessagesFromInlineAttrs()}buildErrorMessageByValidityState(t){const i=this.getErrorMessages();for(const e in t){if(t[e]&&e!=="valid"){if(typeof t[e]==="string"){return t[e]}else{return i[e+"Message"]}}}}}l([i],u.prototype,"checkValidity",null);export{u as F,n as t};
//# sourceMappingURL=p-09dd3509.js.map