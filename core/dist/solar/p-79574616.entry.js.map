{"version":3,"names":["groupBy","key","rv","x","push","acMenuCss","AcMenu","iconOnlyDidUpdate","this","filteredItems","searchFilter","updateChildItems","searchFilterDidUpdate","Object","keys","menuItems","forEach","items","filter","item","fuzzyDescription","indexOf","toLowerCase","elt","disabled","length","groupTitle","componentDidLoad","loadItemsFromHTML","menuItem","childItems","iconOnly","Array","from","menuContentElt","children","tagName","setTimeout","querySelectorAll","submenu","map","parseMenuItems","reduce","addEventListener","selected","id","initialItem","find","select","onDidSelectedUpdate","console","log","targetItem","activeItem","active","menuChange","emit","async","nativeInput","searchInput","getNativeInput","value","hostData","class","__stencil_render","searchable","h","size","placeholder","searchLabel","onKeyUp","handleDebouncedKeyUp","ref","AcFaIcon","slot","icon","faSearch","renderFilteredGroup","__decorate","Bind","Debounced","parents","getMenuItemHierarchy","reverse","breadcrumbs","join","title","innerText","href","onClick","click","parentElement","querySelector","group"],"sources":["./src/utils/collections/group-by.ts","./src/components/molecules/ac-menu/ac-menu.scss?tag=ac-menu","./src/components/molecules/ac-menu/ac-menu.tsx"],"sourcesContent":["export function groupBy(key) {\r\n  return (rv, x) => {\r\n    (rv[x[key]] = rv[x[key]] || []).push(x);\r\n    return rv;\r\n  }\r\n}\r\n","@import \"../../../theme/variables\";\r\n\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n// General Style\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n\r\nac-menu {\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 100%;\r\n  padding: 0 $spacer-tiny;\r\n\r\n  ac-menu-item {\r\n    margin-bottom: $spacer-tiny;\r\n  }\r\n\r\n  .ac-menu__group {\r\n    padding-bottom: $spacer-small;\r\n    .ac-menu__group-title {\r\n      color: current-color(\"contrast\", 0.32);\r\n      font-size: $font-xtiny;\r\n      font-weight: bold;\r\n      text-transform: uppercase;\r\n    }\r\n  }\r\n\r\n  // @TODO: Change the way that we customize compound components\r\n  .ac-menu__search-bar {\r\n    margin-bottom: $spacer-medium;\r\n    transition:\r\n      opacity $default-transition,\r\n      background $default-transition;\r\n    border: 0px;\r\n    background: current-color(\"contrast\", 0.08);\r\n    fill: current-color(\"contrast\") !important;\r\n    &:hover, &.ac-input--focus {\r\n      background: current-color(\"contrast\", 0.16);\r\n    }\r\n\r\n    .ac-input__native {\r\n      color: current-color(\"contrast\") !important;\r\n    }\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n// State Modifiers\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n\r\n// Icon Only mode (icon-only)\r\n// --------------------------------------------------\r\n\r\nac-menu.ac-menu--icon-only {\r\n  ac-input-base.ac-menu__search-bar {\r\n    opacity: 0;\r\n  }\r\n}\r\n\r\n// Filtered mode\r\n// --------------------------------------------------\r\n\r\nac-menu.ac-menu--filtered {\r\n  .ac-menu__content {\r\n    display: none;\r\n  }\r\n}\r\n","import { faSearch } from '@fortawesome/free-solid-svg-icons';\r\nimport { Component, Element, Event, EventEmitter, Prop, State, Watch, h } from '@stencil/core';\r\n\r\nimport { groupBy } from '../../../utils/collections/group-by';\r\nimport { Bind } from '../../../utils/lang/bind';\r\nimport { Debounced } from '../../../utils/lang/reactivity';\r\nimport { AcFaIcon } from '../../utils/ac-fa-icon';\r\n\r\n@Component({\r\n  tag: 'ac-menu',\r\n  styleUrl: 'ac-menu.scss'\r\n})\r\nexport class AcMenu {\r\n  menuContentElt: HTMLElement;\r\n  searchInput: HTMLAcInputBaseElement;\r\n  activeItem: HTMLAcMenuItemElement;\r\n  childItems: HTMLAcMenuItemElement[];\r\n  menuItems: any;\r\n\r\n  @Element() host: HTMLAcMenuElement;\r\n\r\n  @Prop() iconOnly: boolean;\r\n\r\n  @Prop() searchable: boolean;\r\n\r\n  // @TODO: Move labels configs to Solar's global state settings using dependency injection or global state.\r\n  @Prop() searchLabel: string;\r\n  @Prop() noResultsLabel: string;\r\n\r\n  @Prop({ mutable: true }) selected: string | number;\r\n\r\n  @State() searchFilter: string;\r\n\r\n  @State() filteredItems: any;\r\n\r\n  @Event() menuChange: EventEmitter<string>;\r\n\r\n  @Watch('iconOnly')\r\n  iconOnlyDidUpdate() {\r\n    this.filteredItems = null;\r\n    this.searchFilter = null;\r\n    this.updateChildItems();\r\n  }\r\n\r\n  @Watch('searchFilter')\r\n  searchFilterDidUpdate() {\r\n    if (this.searchFilter) {\r\n\r\n      this.filteredItems = [];\r\n      Object.keys(this.menuItems)\r\n        .forEach(key => {\r\n          const items = this.menuItems[key]\r\n            .filter(item => {\r\n              return item.fuzzyDescription.indexOf(this.searchFilter.toLowerCase()) > 0\r\n              && !item.elt.disabled;\r\n            });\r\n\r\n          if (items.length > 0) {\r\n            this.filteredItems.push({ groupTitle: key !== 'null' ? key : null, items });\r\n          }\r\n        });\r\n\r\n    } else {\r\n      this.filteredItems = null;\r\n    }\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.loadItemsFromHTML();\r\n  }\r\n\r\n  private updateChildItems() {\r\n    for (const menuItem of this.childItems) {\r\n      menuItem.iconOnly = this.iconOnly;\r\n    }\r\n  }\r\n\r\n  private loadItemsFromHTML() {\r\n    this.childItems = Array.from(this.menuContentElt.children)\r\n      .filter(elt => elt.tagName === 'AC-MENU-ITEM') as HTMLAcMenuItemElement[];\r\n\r\n    setTimeout(\r\n      () => this.menuItems =\r\n        Array.from(this.menuContentElt.querySelectorAll('ac-menu-item'))\r\n        .filter(elt => !elt.submenu && !elt.disabled)\r\n        .map(parseMenuItems)\r\n        .reduce(groupBy('breadcrumbs'), {}),\r\n      0);\r\n\r\n    this.childItems.forEach(item => {\r\n      if (!item.submenu) {\r\n        item.addEventListener('click', () => this.selected = item.id);\r\n      }\r\n    });\r\n\r\n    // tslint:disable-next-line:triple-equals\r\n    const initialItem = this.childItems.find(item => item.id == this.selected);\r\n    if (initialItem) {\r\n      this.select(initialItem);\r\n    }\r\n    this.updateChildItems();\r\n  }\r\n\r\n  @Watch('selected')\r\n  onDidSelectedUpdate() {\r\n    console.log(this.selected);\r\n    // tslint:disable-next-line:triple-equals\r\n    const targetItem = this.childItems.find(item => item.id == this.selected);\r\n    this.select(targetItem);\r\n  }\r\n\r\n  /**\r\n   * Mark a menu item as selected.\r\n   */\r\n  private select(item: HTMLAcMenuItemElement) {\r\n    if (!this.activeItem) {\r\n      this.activeItem = item;\r\n    }\r\n    if (this.activeItem.id !== item.id) {\r\n      this.activeItem.active = false;\r\n      this.menuChange.emit(item.id);\r\n    }\r\n    item.active = true;\r\n    this.activeItem = item;\r\n  }\r\n\r\n  @Bind\r\n  @Debounced(200)\r\n  private async handleDebouncedKeyUp() {\r\n    const nativeInput = await this.searchInput.getNativeInput();\r\n    this.searchFilter = nativeInput.value;\r\n  }\r\n\r\n  hostData() {\r\n    return {\r\n      class: {\r\n        'ac-menu--icon-only': this.iconOnly,\r\n        'ac-menu--filtered': this.searchFilter\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return [\r\n      // Searchbar\r\n      this.searchable &&\r\n        <ac-input-base\r\n            class=\"ac-menu__search-bar\"\r\n            size=\"small\"\r\n            placeholder={this.searchLabel || 'Search'}\r\n            onKeyUp={this.handleDebouncedKeyUp}\r\n            ref={searchInput => this.searchInput = searchInput as HTMLAcInputBaseElement}\r\n        >\r\n          <AcFaIcon slot=\"item-start\" icon={faSearch} size={12} />\r\n        </ac-input-base>,\r\n\r\n      // Content\r\n      <div class=\"ac-menu__content\" ref={menuContentElt => this.menuContentElt = menuContentElt}>\r\n        <slot />\r\n      </div>,\r\n\r\n      // Search Results\r\n      this.filteredItems && this.filteredItems.length > 0 &&\r\n        <div class=\"ac-menu__search-results\">\r\n          {this.filteredItems.map(renderFilteredGroup)}\r\n        </div>\r\n    ];\r\n  }\r\n}\r\n\r\n// Utils\r\n// --------------------------------------------------\r\n\r\nfunction parseMenuItems(elt) {\r\n  const parents = getMenuItemHierarchy(elt, []).reverse();\r\n\r\n  return {\r\n    elt,\r\n    parents,\r\n    breadcrumbs: parents.length > 0 ? parents.join(' > ') : null,\r\n    title: elt.innerText,\r\n    href: elt.href,\r\n    onClick: () => elt.click(),\r\n    fuzzyDescription: (parents.join('; ') + '; ' + elt.innerText + '; ' + elt.href).toLowerCase()\r\n  }\r\n}\r\n\r\nfunction getMenuItemHierarchy(elt, parents) {\r\n  if (elt.parentElement.slot !== 'submenu') {\r\n    return parents;\r\n  }\r\n\r\n  const menuItem = elt.parentElement.parentElement.parentElement;\r\n  parents.push(menuItem.querySelector('.ac-menu-item__native > .ac-menu-item__text').innerText);\r\n  return getMenuItemHierarchy(menuItem, parents)\r\n}\r\n\r\nfunction renderFilteredGroup(group) {\r\n  return (\r\n    <div class=\"ac-menu__group\">\r\n      <span class=\"ac-menu__group-title\">{group.groupTitle}</span>\r\n      {\r\n        group.items.map(item => (\r\n          <ac-menu-item href={item.href} onClick={item.onClick}>\r\n            {item.title}\r\n          </ac-menu-item>\r\n        ))\r\n      }\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"}