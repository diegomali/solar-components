{"version":3,"file":"ac-menu.js","sourceRoot":"","sources":["../../../../src/components/molecules/ac-menu/ac-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["import { faSearch } from '@fortawesome/free-solid-svg-icons';\r\nimport { Component, Element, Event, EventEmitter, Prop, State, Watch, h } from '@stencil/core';\r\n\r\nimport { groupBy } from '../../../utils/collections/group-by';\r\nimport { Bind } from '../../../utils/lang/bind';\r\nimport { Debounced } from '../../../utils/lang/reactivity';\r\nimport { AcFaIcon } from '../../utils/ac-fa-icon';\r\n\r\n@Component({\r\n  tag: 'ac-menu',\r\n  styleUrl: 'ac-menu.scss'\r\n})\r\nexport class AcMenu {\r\n  menuContentElt: HTMLElement;\r\n  searchInput: HTMLAcInputBaseElement;\r\n  activeItem: HTMLAcMenuItemElement;\r\n  childItems: HTMLAcMenuItemElement[];\r\n  menuItems: any;\r\n\r\n  @Element() host: HTMLAcMenuElement;\r\n\r\n  @Prop() iconOnly: boolean;\r\n\r\n  @Prop() searchable: boolean;\r\n\r\n  // @TODO: Move labels configs to Solar's global state settings using dependency injection or global state.\r\n  @Prop() searchLabel: string;\r\n  @Prop() noResultsLabel: string;\r\n\r\n  @Prop({ mutable: true }) selected: string | number;\r\n\r\n  @State() searchFilter: string;\r\n\r\n  @State() filteredItems: any;\r\n\r\n  @Event() menuChange: EventEmitter<string>;\r\n\r\n  @Watch('iconOnly')\r\n  iconOnlyDidUpdate() {\r\n    this.filteredItems = null;\r\n    this.searchFilter = null;\r\n    this.updateChildItems();\r\n  }\r\n\r\n  @Watch('searchFilter')\r\n  searchFilterDidUpdate() {\r\n    if (this.searchFilter) {\r\n\r\n      this.filteredItems = [];\r\n      Object.keys(this.menuItems)\r\n        .forEach(key => {\r\n          const items = this.menuItems[key]\r\n            .filter(item => {\r\n              return item.fuzzyDescription.indexOf(this.searchFilter.toLowerCase()) > 0\r\n              && !item.elt.disabled;\r\n            });\r\n\r\n          if (items.length > 0) {\r\n            this.filteredItems.push({ groupTitle: key !== 'null' ? key : null, items });\r\n          }\r\n        });\r\n\r\n    } else {\r\n      this.filteredItems = null;\r\n    }\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.loadItemsFromHTML();\r\n  }\r\n\r\n  private updateChildItems() {\r\n    for (const menuItem of this.childItems) {\r\n      menuItem.iconOnly = this.iconOnly;\r\n    }\r\n  }\r\n\r\n  private loadItemsFromHTML() {\r\n    this.childItems = Array.from(this.menuContentElt.children)\r\n      .filter(elt => elt.tagName === 'AC-MENU-ITEM') as HTMLAcMenuItemElement[];\r\n\r\n    setTimeout(\r\n      () => this.menuItems =\r\n        Array.from(this.menuContentElt.querySelectorAll('ac-menu-item'))\r\n        .filter(elt => !elt.submenu && !elt.disabled)\r\n        .map(parseMenuItems)\r\n        .reduce(groupBy('breadcrumbs'), {}),\r\n      0);\r\n\r\n    this.childItems.forEach(item => {\r\n      if (!item.submenu) {\r\n        item.addEventListener('click', () => this.selected = item.id);\r\n      }\r\n    });\r\n\r\n    // tslint:disable-next-line:triple-equals\r\n    const initialItem = this.childItems.find(item => item.id == this.selected);\r\n    if (initialItem) {\r\n      this.select(initialItem);\r\n    }\r\n    this.updateChildItems();\r\n  }\r\n\r\n  @Watch('selected')\r\n  onDidSelectedUpdate() {\r\n    console.log(this.selected);\r\n    // tslint:disable-next-line:triple-equals\r\n    const targetItem = this.childItems.find(item => item.id == this.selected);\r\n    this.select(targetItem);\r\n  }\r\n\r\n  /**\r\n   * Mark a menu item as selected.\r\n   */\r\n  private select(item: HTMLAcMenuItemElement) {\r\n    if (!this.activeItem) {\r\n      this.activeItem = item;\r\n    }\r\n    if (this.activeItem.id !== item.id) {\r\n      this.activeItem.active = false;\r\n      this.menuChange.emit(item.id);\r\n    }\r\n    item.active = true;\r\n    this.activeItem = item;\r\n  }\r\n\r\n  @Bind\r\n  @Debounced(200)\r\n  private async handleDebouncedKeyUp() {\r\n    const nativeInput = await this.searchInput.getNativeInput();\r\n    this.searchFilter = nativeInput.value;\r\n  }\r\n\r\n  hostData() {\r\n    return {\r\n      class: {\r\n        'ac-menu--icon-only': this.iconOnly,\r\n        'ac-menu--filtered': this.searchFilter\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return [\r\n      // Searchbar\r\n      this.searchable &&\r\n        <ac-input-base\r\n            class=\"ac-menu__search-bar\"\r\n            size=\"small\"\r\n            placeholder={this.searchLabel || 'Search'}\r\n            onKeyUp={this.handleDebouncedKeyUp}\r\n            ref={searchInput => this.searchInput = searchInput as HTMLAcInputBaseElement}\r\n        >\r\n          <AcFaIcon slot=\"item-start\" icon={faSearch} size={12} />\r\n        </ac-input-base>,\r\n\r\n      // Content\r\n      <div class=\"ac-menu__content\" ref={menuContentElt => this.menuContentElt = menuContentElt}>\r\n        <slot />\r\n      </div>,\r\n\r\n      // Search Results\r\n      this.filteredItems && this.filteredItems.length > 0 &&\r\n        <div class=\"ac-menu__search-results\">\r\n          {this.filteredItems.map(renderFilteredGroup)}\r\n        </div>\r\n    ];\r\n  }\r\n}\r\n\r\n// Utils\r\n// --------------------------------------------------\r\n\r\nfunction parseMenuItems(elt) {\r\n  const parents = getMenuItemHierarchy(elt, []).reverse();\r\n\r\n  return {\r\n    elt,\r\n    parents,\r\n    breadcrumbs: parents.length > 0 ? parents.join(' > ') : null,\r\n    title: elt.innerText,\r\n    href: elt.href,\r\n    onClick: () => elt.click(),\r\n    fuzzyDescription: (parents.join('; ') + '; ' + elt.innerText + '; ' + elt.href).toLowerCase()\r\n  }\r\n}\r\n\r\nfunction getMenuItemHierarchy(elt, parents) {\r\n  if (elt.parentElement.slot !== 'submenu') {\r\n    return parents;\r\n  }\r\n\r\n  const menuItem = elt.parentElement.parentElement.parentElement;\r\n  parents.push(menuItem.querySelector('.ac-menu-item__native > .ac-menu-item__text').innerText);\r\n  return getMenuItemHierarchy(menuItem, parents)\r\n}\r\n\r\nfunction renderFilteredGroup(group) {\r\n  return (\r\n    <div class=\"ac-menu__group\">\r\n      <span class=\"ac-menu__group-title\">{group.groupTitle}</span>\r\n      {\r\n        group.items.map(item => (\r\n          <ac-menu-item href={item.href} onClick={item.onClick}>\r\n            {item.title}\r\n          </ac-menu-item>\r\n        ))\r\n      }\r\n    </div>\r\n  );\r\n}\r\n"]}